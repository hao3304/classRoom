query GetTickets(
  $type: String
  $sn: String
  $address: String
  $remark: String
  $pstime: String
  $petime: String
  $time: Int
  $orders: [String!]!
  $page: Int!
  $limit: Int!
  $count: Boolean!
  $status: String
  $own: Boolean
) {
  tickets(
    input: {
      time: $time
      sn: $sn
      type: $type
      address: $address
      remark: $remark
      pstime: $pstime
      petime: $petime
      status: $status
      orders: $orders
      page: $page
      limit: $limit
      count: $count
      own: $own
    }
  ) {
    size
    total
    data {
      id
      status
      created
      changed
      type
      state
      sn
      address
      position
      desc
      remark
      assignee
      otype
      oid
      term
      live
      creator {
        id
        name
      }

      worker {
        id
        name
      }

      tstate {
        id
        name
        mode
        autos
        roles {
          id
          name
        }
      }

      actions {
        id
        name
        fields {
          id
          action
          name
          desc
          ftype
          format
          default
          required
          ofield
        }

        action_estate {
          id
          name
          mode
          autos
          roles {
            id
            name
          }
        }
      }
    }
  }
}

query GetAllTickets(
  $type: String
  $sn: String
  $address: String
  $remark: String
  $pstime: String
  $petime: String
  $time: Int
  $orders: [String!]!
  $page: Int!
  $limit: Int!
  $count: Boolean!
  $status: String
  $own: Boolean
) {
  tickets(
    input: {
      time: $time
      sn: $sn
      type: $type
      address: $address
      remark: $remark
      pstime: $pstime
      petime: $petime
      status: $status
      orders: $orders
      page: $page
      limit: $limit
      count: $count
      own: $own
    }
  ) {
    size
    total
    data {
      id
      status
      created
      changed
      type
      state
      sn
      address
      position
      desc
      remark
      assignee
      otype
      oid
      term
      live
      creator {
        id
        name
      }

      tstate {
        id
        name
        mode
      }

      actions {
        id
        name
      }

      worker {
        id
        name
      }
    }
  }
}

query TicketTypes {
  ticket_types {
    id
    name
    term
  }
}

query TicketTypeById($id: String!) {
  ticketType: ticket_types(id: $id) {
    id
    name
    states {
      id
      status
      type
      name
      uid
      mode
      weight
      autos
      created
      changed
      user {
        name
      }

      roles {
        id
        name
      }
    }

    creation {
      id
      status
      name
      fields {
        id
        name
        status
        action
        desc
        ftype
        span
        format
        default
        required
        ofield
        weight
      }
    }
  }
}

query GetTicket($id: String!) {
  ticket(id: $id) {
    id
    status
    created
    changed
    type
    state
    sn
    address
    position
    desc
    remark
    assignee
    otype
    oid
    term
    live
    creator {
      id
      name
    }

    worker {
      id
      name
    }

    tstate {
      id
      name
      mode
      autos
      roles {
        id
        name
      }
    }

    actions {
      id
      name
      fields {
        id
        action
        name
        desc
        ftype
        format
        default
        required
        ofield
      }

      action_estate {
        id
        name
        mode
        autos
        roles {
          id
          name
        }
      }
    }

    tracks {
      id
      status
      created
      changed
      uid
      level
      action
      state
      ticket
      parent
      remark
      operator {
        name
      }
      ticket_action {
        id
        name
        fields {
          id
          ftype
          name
        }
      }

      track_fields {
        id
        value
        field
        track
        track_field {
          name
          ftype
          format
        }
      }
    }
  }
}

query TicketStat($own: Boolean) {
  ticket_stat(own: $own) {
    status {
      working
      pending
      closed
      auditing
    }
    types {
      type
      name
      total
    }
  }
}

mutation TicketStateUpdate(
  $id: String
  $status: Int
  $type: String
  $name: String
  $autos: Int
  $mode: Int
  $uid: String
  $weight: Int
  $roles: [String!]
) {
  ticket_state_update(
    input: {
      id: $id
      status: $status
      type: $type
      name: $name
      mode: $mode
      uid: $uid
      autos: $autos
      weight: $weight
      roles: $roles
    }
  ) {
    id
  }
}

mutation TicketStateCreate(
  $type: String
  $name: String!
  $mode: Int!
  $autos: Int
  $uid: String
  $weight: Int!
  $roles: [String!]
) {
  ticket_state_create(
    input: {
      type: $type
      name: $name
      mode: $mode
      autos: $autos
      uid: $uid
      weight: $weight
      roles: $roles
    }
  ) {
    id
  }
}

mutation TicketCreate($input: ITicket!) {
  ticket_create(input: $input) {
    id
  }
}

mutation TicketAction(
  $ticket: String!
  $action: String!
  $assignee: String
  $remark: String
  $fields: [ITicketActionField!]
) {
  ticket_action(
    input: {
      ticket: $ticket
      action: $action
      assignee: $assignee
      remark: $remark
      fields: $fields
    }
  ) {
    track
  }
}

subscription TicketAssign($token: String!) {
  ticket_action(token: $token) {
    id
    sn
    type
    address
  }
}
